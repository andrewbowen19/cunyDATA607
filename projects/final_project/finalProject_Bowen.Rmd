---
title: "DATA 607 Final Project"
author: "Andrew Bowen"
date: "2022-11-23"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, echo=FALSE, message=FALSE}
library(httr)
library(jsonlite)
library(tidyverse)
library(sf) # for geospatial data lookup
```
## Motivation
- **Research Question**: Do environmental factors (like air quality) impact a student's academic performance?



## Datasources
- [AQ Air Quality Public REST API](https://docs.openaq.org/reference/introduction-1)
- [NYC Open Data Education files on test results](https://data.cityofnewyork.us/browse?category=Education&q=Test&sortBy=relevance) : while not a perfect indicator of academic performance, these do give some insight into the academic progress of students in different areas of the city.

## Pulling Air Quality Data for New York City
```{r, echo=TRUE}
url <- "https://api.openaq.org/v2/measurements"

queryString <- list(
  sort = "desc",
  radius = "1000",
  order_by = "datetime",
  city = "New York"
)

response <- VERB("GET", url, query = queryString,
                 content_type("application/octet-stream"),
                 accept("application/json"))

as.data.frame(fromJSON(rawToChar(content(response, "raw"))))
```

## Cleaning Air Quality Data
```{r}

```



## Academic Performance Data
- [Dataset from NYC Open Data](https://data.cityofnewyork.us/Education/2006-2012-Math-Test-Results-All-Students/3mrr-8h5c/data) (csv) -- test results by student.
- Can use District Borough Number (DBN) to lookup geographic locations and compare against AQ data
```{r, echo=TRUE}
dbn_url <- "https://raw.githubusercontent.com/andrewbowen19/cunyDATA607/main/projects/final_project/2006_-_2012__Math_Test_Results__-_All_Students.csv"

tests <- read.csv(dbn_url)

head(tests)


```



## Getting School Geospatial Data
Looking up [school district GIS data from NYC Open Data](https://data.cityofnewyork.us/Education/School-Districts/r8nu-ymqj). School point locations can be found [here](https://data.cityofnewyork.us/Education/School-Point-Locations/jfju-ynrr), we'll download them and unzip the file to get the shp file
```{r}
# Create temporary files
temp <- tempfile()
temp2 <- tempfile()

# Download the zip file and save to 'temp' 
school_locs_url <- "https://data.cityofnewyork.us/download/jfju-ynrr/application%2Fzip"
download.file(school_locs_url, temp)

# Unzip the folder contents and then read in the shp file to a dataframe
unzip(zipfile = temp, exdir = temp2)
school_locs <- sf::read_sf(temp2)
```

```{r}
# Cleaning and re-naming the ATS_CODE column to 
school_locs <- school_locs %>% 
                  dplyr::rename( "DBN"="ATS_CODE")
school_locs$DBN <- str_replace_all(school_locs$DBN, "\\s+", "")
```

## Joining & Cleaning Academic Data
Let's join our `school_locs` dataframe to our `tests` 
```{r}
school_data <- left_join(tests, school_locs, by="DBN")
```


